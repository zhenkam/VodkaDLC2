<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - VodkaClient</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: #000000;
    color: #fff;
    min-height: 100vh;
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
nav {
    position: relative;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 60px;
    background: rgba(10, 10, 10, 0.9);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 50, 50, 0.5);
}

.logo {
    font-size: 24px;
    font-weight: 700;
    letter-spacing: 2px;
    color: #ff5555;
    text-decoration: none;
}

.admin-badge {
    padding: 6px 12px;
    background: rgba(255, 50, 50, 0.2);
    border: 1px solid rgba(255, 50, 50, 0.5);
    border-radius: 6px;
    color: #ff5555;
    font-size: 12px;
    font-weight: 600;
}

/* –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ */
.login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 80px);
    padding: 20px;
}

.login-box {
    background: rgba(20, 20, 20, 0.8);
    border: 1px solid rgba(255, 50, 50, 0.5);
    border-radius: 16px;
    padding: 40px;
    max-width: 400px;
    width: 100%;
}

.login-box h2 {
    text-align: center;
    margin-bottom: 30px;
    color: #ff5555;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.8);
}

.form-group input {
    width: 100%;
    padding: 12px 16px;
    background: rgba(10, 10, 10, 0.8);
    border: 1px solid rgba(60, 60, 60, 0.5);
    border-radius: 8px;
    color: #fff;
    font-size: 14px;
}

.form-group input:focus {
    outline: none;
    border-color: #ff5555;
}

.btn-login {
    width: 100%;
    padding: 14px;
    background: rgba(255, 50, 50, 0.2);
    border: 1px solid rgba(255, 50, 50, 0.5);
    border-radius: 8px;
    color: #ff5555;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-login:hover {
    background: rgba(255, 50, 50, 0.3);
}

.error-message {
    background: rgba(255, 50, 50, 0.2);
    border: 1px solid rgba(255, 50, 50, 0.5);
    color: #ff5555;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: none;
}

/* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å */
.admin-container {
    max-width: 1400px;
    margin: 40px auto;
    padding: 0 30px;
    display: none;
}

.admin-header {
    text-align: center;
    margin-bottom: 40px;
}

.admin-header h1 {
    font-size: 42px;
    color: #ff5555;
    margin-bottom: 10px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    background: rgba(20, 20, 20, 0.8);
    border: 1px solid rgba(60, 60, 60, 0.5);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
}

.stat-card h3 {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.6);
    margin-bottom: 10px;
    text-transform: uppercase;
}

.stat-card .value {
    font-size: 36px;
    font-weight: 700;
    color: #ff5555;
}

/* –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
.users-section {
    background: rgba(20, 20, 20, 0.8);
    border: 1px solid rgba(60, 60, 60, 0.5);
    border-radius: 12px;
    padding: 30px;
}

.users-section h2 {
    font-size: 28px;
    margin-bottom: 20px;
    color: #ff5555;
}

.users-table {
    width: 100%;
    border-collapse: collapse;
}

.users-table th {
    background: rgba(255, 50, 50, 0.1);
    padding: 15px;
    text-align: left;
    font-weight: 600;
    color: #ff5555;
    border-bottom: 2px solid rgba(255, 50, 50, 0.3);
}

.users-table td {
    padding: 15px;
    border-bottom: 1px solid rgba(60, 60, 60, 0.3);
}

.users-table tr:hover {
    background: rgba(30, 30, 30, 0.5);
}

.btn-delete {
    padding: 6px 12px;
    background: rgba(255, 50, 50, 0.2);
    border: 1px solid rgba(255, 50, 50, 0.5);
    border-radius: 6px;
    color: #ff5555;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-delete:hover {
    background: rgba(255, 50, 50, 0.3);
}

.btn-logout {
    padding: 10px 24px;
    background: rgba(255, 50, 50, 0.2);
    border: 1px solid rgba(255, 50, 50, 0.5);
    border-radius: 8px;
    color: #ff5555;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    text-decoration: none;
}

.btn-logout:hover {
    background: rgba(255, 50, 50, 0.3);
}

.btn-generate {
    padding: 12px 20px;
    background: rgba(50, 255, 50, 0.2);
    border: 1px solid rgba(50, 255, 50, 0.5);
    border-radius: 8px;
    color: #55ff55;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-generate:hover {
    background: rgba(50, 255, 50, 0.3);
}
</style>
</head>

<body>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<nav>
    <a href="/" class="logo">üî¥ ADMIN PANEL</a>
    <div class="admin-badge">–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†</div>
</nav>

<!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
<div id="loginContainer" class="login-container">
    <div class="login-box">
        <h2>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
        <div id="errorMessage" class="error-message"></div>
        <form id="adminLoginForm">
            <div class="form-group">
                <label>–õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                <input type="text" id="adminUsername" placeholder="ServerVodki" required>
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            </div>
            <button type="submit" class="btn-login">–í–æ–π—Ç–∏</button>
        </form>
    </div>
</div>

<!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
<div id="adminContainer" class="admin-container">
    <div class="admin-header">
        <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ VodkaClient</p>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <div class="value" id="totalUsers">0</div>
        </div>
        <div class="stat-card">
            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–π UID</h3>
            <div class="value" id="lastUid">0</div>
        </div>
        <div class="stat-card">
            <h3>–°–µ–≥–æ–¥–Ω—è</h3>
            <div class="value" id="todayUsers">0</div>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="users-section">
        <h2>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
        <table class="users-table">
            <thead>
                <tr>
                    <th>UID</th>
                    <th>–õ–æ–≥–∏–Ω</th>
                    <th>–ü–æ–¥–ø–∏—Å–∫–∞</th>
                    <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="usersTableBody">
                <tr>
                    <td colspan="5" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π -->
    <div class="users-section" style="margin-top: 30px;">
        <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <button class="btn-generate" onclick="generateKey('1month', 30)">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á 1 –º–µ—Å—è—Ü</button>
            <button class="btn-generate" onclick="generateKey('6months', 180)">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á 6 –º–µ—Å—è—Ü–µ–≤</button>
            <button class="btn-generate" onclick="generateKey('lifetime', 0)">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á LifeTime</button>
        </div>
        
        <div id="generatedKey" style="display: none; background: rgba(50, 255, 50, 0.1); border: 1px solid rgba(50, 255, 50, 0.3); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="font-size: 16px; margin-bottom: 10px;">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á:</h3>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" id="keyDisplay" readonly style="flex: 1; padding: 12px; background: rgba(10, 10, 10, 0.8); border: 1px solid rgba(60, 60, 60, 0.5); border-radius: 6px; color: #55ff55; font-size: 16px; font-weight: 600;">
                <button onclick="copyKey()" style="padding: 12px 20px; background: rgba(50, 255, 50, 0.2); border: 1px solid rgba(50, 255, 50, 0.5); border-radius: 6px; color: #55ff55; cursor: pointer;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
        
        <h3 style="font-size: 20px; margin-bottom: 15px;">–í—Å–µ –∫–ª—é—á–∏</h3>
        <table class="users-table">
            <thead>
                <tr>
                    <th>–ö–ª—é—á</th>
                    <th>–¢–∏–ø</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω</th>
                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                </tr>
            </thead>
            <tbody id="keysTableBody">
                <tr>
                    <td colspan="5" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div style="text-align: center; margin-top: 40px;">
        <button class="btn-logout" id="adminLogoutBtn">–í—ã–π—Ç–∏</button>
    </div>
</div>

<script>
const ADMIN_USERNAME = 'ServerVodki';
const ADMIN_PASSWORD = 'irairairA1';

let isAdminLoggedIn = false;

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
function checkAdminSession() {
    const adminSession = localStorage.getItem('adminLoggedIn');
    if (adminSession === 'true') {
        isAdminLoggedIn = true;
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('adminContainer').style.display = 'block';
        loadAdminData();
    }
}

// –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
document.getElementById('adminLoginForm').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const username = document.getElementById('adminUsername').value;
    const password = document.getElementById('adminPassword').value;
    
    if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        isAdminLoggedIn = true;
        localStorage.setItem('adminLoggedIn', 'true'); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('adminContainer').style.display = 'block';
        loadAdminData();
    } else {
        const errorMsg = document.getElementById('errorMessage');
        errorMsg.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
        errorMsg.style.display = 'block';
    }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
async function loadAdminData() {
    try {
        const response = await fetch('/api/admin/users');
        const data = await response.json();
        
        if (data.success) {
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('totalUsers').textContent = data.users.length;
            document.getElementById('lastUid').textContent = data.users.length > 0 ? data.users[data.users.length - 1].uid : 0;
            
            // –ü–æ–¥—Å—á–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            const today = new Date().toDateString();
            const todayCount = data.users.filter(u => {
                const userDate = new Date(u.created_at).toDateString();
                return userDate === today;
            }).length;
            document.getElementById('todayUsers').textContent = todayCount;
            
            // –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            data.users.forEach(user => {
                const tr = document.createElement('tr');
                const date = new Date(user.created_at).toLocaleString('ru-RU');
                
                let subscriptionText = '–ù–µ—Ç';
                if (user.subscription_type) {
                    if (user.subscription_type === 'lifetime') {
                        const expires = new Date(user.subscription_expires);
                        subscriptionText = `<span style="color: #55ff55;">LifeTime (–¥–æ ${expires.toLocaleDateString('ru-RU')})</span>`;
                    } else {
                        const expires = new Date(user.subscription_expires);
                        const isActive = expires > new Date();
                        const color = isActive ? '#55ff55' : '#ff5555';
                        subscriptionText = `<span style="color: ${color};">${user.subscription_type} (–¥–æ ${expires.toLocaleDateString('ru-RU')})</span>`;
                    }
                }
                
                tr.innerHTML = `
                    <td><strong>${user.uid}</strong></td>
                    <td>${user.username}</td>
                    <td>${subscriptionText}</td>
                    <td>${date}</td>
                    <td>
                        <button class="btn-delete" onclick="deleteUser(${user.uid}, '${user.username}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–µ–π
    loadKeys();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–µ–π
async function loadKeys() {
    try {
        const response = await fetch('/api/admin/keys');
        const data = await response.json();
        
        if (data.success) {
            const tbody = document.getElementById('keysTableBody');
            tbody.innerHTML = '';
            
            if (data.keys.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">–ö–ª—é—á–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã</td></tr>';
                return;
            }
            
            data.keys.forEach(key => {
                const tr = document.createElement('tr');
                const date = new Date(key.created_at).toLocaleString('ru-RU');
                
                let typeText = key.subscription_type;
                if (key.subscription_type === 'lifetime') {
                    typeText = 'LifeTime';
                } else if (key.subscription_type === '1month') {
                    typeText = '1 –º–µ—Å—è—Ü';
                } else if (key.subscription_type === '6months') {
                    typeText = '6 –º–µ—Å—è—Ü–µ–≤';
                }
                
                const statusColor = key.used ? '#ff5555' : '#55ff55';
                const statusText = key.used ? '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω';
                
                const usedInfo = key.used ? `UID: ${key.used_by}` : '-';
                
                tr.innerHTML = `
                    <td style="font-family: monospace; font-size: 12px;">${key.key_code}</td>
                    <td>${typeText}</td>
                    <td><span style="color: ${statusColor};">${statusText}</span></td>
                    <td>${usedInfo}</td>
                    <td>${date}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª—é—á–µ–π:', error);
    }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞
async function generateKey(type, days) {
    try {
        const response = await fetch('/api/admin/generate-key', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ subscription_type: type, duration_days: days })
        });
        
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('generatedKey').style.display = 'block';
            document.getElementById('keyDisplay').value = data.key;
            loadKeys();
        } else {
            alert('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–∞');
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
    }
}

// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞
function copyKey() {
    const keyInput = document.getElementById('keyDisplay');
    keyInput.select();
    document.execCommand('copy');
    alert('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
}

// –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function deleteUser(uid, username) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${username}" (UID: ${uid})?`)) {
        return;
    }
    
    try {
        const response = await fetch('/api/admin/delete-user', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ uid })
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω');
            loadAdminData();
        } else {
            alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
    }
}

// –í—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
document.getElementById('adminLogoutBtn').addEventListener('click', () => {
    localStorage.removeItem('adminLoggedIn'); // –£–¥–∞–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
    window.location.href = '/';
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
checkAdminSession();
</script>

</body>
</html>
